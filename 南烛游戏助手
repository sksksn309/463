-- å—çƒ›æ¸¸æˆåŠ©æ‰‹ä¸»è„šæœ¬
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

-- å‘é€èŠå¤©æ¶ˆæ¯
local function SendChatMessage(message, teamOnly)
    local ChatService = game:GetService("Chat")
    ChatService.ChatLocal(message, "System", LocalPlayer)
    if teamOnly then
        ChatService.ChatPrivate(message, "System", LocalPlayer, LocalPlayer)
    end
end

-- åˆ›å»ºæç¤ºæ¡†
local function CreateNotification(text, duration)
    duration = duration or 3
    local notification = Instance.new("TextLabel")
    notification.Name = "GameHelperNotification"
    notification.Text = text
    notification.TextColor3 = Color3.new(1, 1, 1)
    notification.BackgroundColor3 = Color3.new(0, 0, 0)
    notification.BackgroundTransparency = 0.5
    notification.Size = UDim2.new(0.2, 0, 0.05, 0)
    notification.Position = UDim2.new(0.8, 0, 0.9, 0)
    notification.Font = Enum.Font.SourceSansBold
    notification.TextSize = 14
    notification.Parent = PlayerGui
    
    -- æ·¡å‡ºæ•ˆæœ
    TweenService:Create(
        notification,
        TweenInfo.new(1, Enum.EasingStyle.Linear),
        {TextTransparency = 1, BackgroundTransparency = 1}
    ):Play()
    
    game.Debris:AddItem(notification, duration)
end

-- åˆ›å»ºå¡å¯†ç³»ç»Ÿ
local function CreateKeySystem()
    local keyGui = Instance.new("ScreenGui")
    keyGui.Name = "NanzhuKeySystem"
    keyGui.ResetOnSpawn = false
    
    -- èƒŒæ™¯é®ç½©
    local background = Instance.new("Frame")
    background.Name = "Background"
    background.Size = UDim2.new(1, 0, 1, 0)
    background.BackgroundColor3 = Color3.new(0, 0, 0)
    background.BackgroundTransparency = 0.5
    background.BorderSizePixel = 0
    background.Parent = keyGui
    
    -- ä¸»å¼¹çª—
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0.5, 0, 0.4, 0)
    mainFrame.Position = UDim2.new(0.25, 0, 0.3, 0)
    mainFrame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = keyGui
    
    -- æ ‡é¢˜
    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Text = "å—çƒ›æ¸¸æˆåŠ©æ‰‹ - å¡å¯†éªŒè¯"
    title.TextColor3 = Color3.new(1, 1, 1)
    title.BackgroundTransparency = 1
    title.Size = UDim2.new(1, 0, 0.2, 0)
    title.Font = Enum.Font.SourceSansBold
    title.TextSize = 24
    title.Parent = mainFrame
    
    -- æç¤ºæ–‡æœ¬
    local hintText = Instance.new("TextLabel")
    hintText.Name = "HintText"
    hintText.Text = "è·å–è„šæœ¬å¡å¯†è¯·åŠ ğŸ§ç¾¤ï¼š123456789"
    hintText.TextColor3 = Color3.new(1, 0.5, 0.5)
    hintText.BackgroundTransparency = 1
    hintText.Size = UDim2.new(1, 0, 0.2, 0)
    hintText.Position = UDim2.new(0, 0, 0.2, 0)
    hintText.Font = Enum.Font.SourceSans
    hintText.TextSize = 16
    hintText.Parent = mainFrame
    
    -- è¾“å…¥æ¡†
    local inputBox = Instance.new("TextBox")
    inputBox.Name = "InputBox"
    inputBox.PlaceholderText = "è¯·è¾“å…¥å¡å¯†"
    inputBox.Text = ""
    inputBox.TextColor3 = Color3.new(1, 1, 1)
    inputBox.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    inputBox.Size = UDim2.new(0.8, 0, 0.15, 0)
    inputBox.Position = UDim2.new(0.1, 0, 0.45, 0)
    inputBox.Font = Enum.Font.SourceSans
    inputBox.TextSize = 18
    inputBox.Parent = mainFrame
    
    -- æäº¤æŒ‰é’®
    local submitButton = Instance.new("TextButton")
    submitButton.Name = "SubmitButton"
    submitButton.Text = "éªŒè¯"
    submitButton.TextColor3 = Color3.new(1, 1, 1)
    submitButton.BackgroundColor3 = Color3.new(0.2, 0.5, 0.2)
    submitButton.Size = UDim2.new(0.5, 0, 0.15, 0)
    submitButton.Position = UDim2.new(0.25, 0, 0.65, 0)
    submitButton.Font = Enum.Font.SourceSansBold
    submitButton.TextSize = 18
    submitButton.Parent = mainFrame
    
    -- ä½¿å¼¹çª—å¯æ‹–åŠ¨
    local dragging = false
    local dragStartPos = Vector2.new(0, 0)
    local frameStartPos = Vector2.new(0, 0)
    
    mainFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStartPos = Vector2.new(input.Position.X, input.Position.Y)
            frameStartPos = Vector2.new(mainFrame.Position.X.Offset, mainFrame.Position.Y.Offset)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = Vector2.new(input.Position.X, input.Position.Y) - dragStartPos
            mainFrame.Position = UDim2.new(0, frameStartPos.X + delta.X, 0, frameStartPos.Y + delta.Y)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    -- éªŒè¯é€»è¾‘
    submitButton.MouseButton1Click:Connect(function()
        local inputKey = inputBox.Text
        if inputKey == "nznb666" then
            CreateNotification("éªŒè¯æˆåŠŸï¼Œæ­£åœ¨åŠ è½½ä¸»ç•Œé¢...", 2)
            wait(2)
            keyGui:Destroy()
            CreateMainPopup()
        else
            CreateNotification("å¡å¯†é”™è¯¯ï¼Œæ‚¨å°†è¢«è¸¢å‡ºæ¸¸æˆ", 2)
            wait(2)
            LocalPlayer:Kick("key wrong")
        end
    end)
    
    keyGui.Parent = PlayerGui
    return keyGui
end

-- åˆ›å»ºä¸»å¼¹çª—
local function CreateMainPopup()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "NanzhuGameHelper"
    screenGui.ResetOnSpawn = false
    
    -- èƒŒæ™¯é®ç½©
    local background = Instance.new("Frame")
    background.Name = "Background"
    background.Size = UDim2.new(1, 0, 1, 0)
    background.BackgroundColor3 = Color3.new(0, 0, 0)
    background.BackgroundTransparency = 0.5
    background.BorderSizePixel = 0
    background.Parent = screenGui
    
    -- ä¸»å¼¹çª—
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0.4, 0, 0.6, 0)
    mainFrame.Position = UDim2.new(0.3, 0, 0.2, 0)
    mainFrame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = screenGui
    
    -- æ ‡é¢˜
    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Text = "å—çƒ›æ¸¸æˆåŠ©æ‰‹"
    title.TextColor3 = Color3.new(1, 1, 1)
    title.BackgroundTransparency = 1
    title.Size = UDim2.new(1, 0, 0.1, 0)
    title.Font = Enum.Font.SourceSansBold
    title.TextSize = 20
    title.Parent = mainFrame
    
    -- å…³é—­æŒ‰é’®
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.Text = "X"
    closeButton.TextColor3 = Color3.new(1, 1, 1)
    closeButton.BackgroundTransparency = 1
    closeButton.Size = UDim2.new(0.1, 0, 0.1, 0)
    closeButton.Position = UDim2.new(0.9, 0, 0, 0)
    closeButton.Font = Enum.Font.SourceSansBold
    closeButton.TextSize = 20
    closeButton.Parent = mainFrame
    
    -- åˆ†ç±»å®¹å™¨
    local categories = Instance.new("ScrollingFrame")
    categories.Name = "Categories"
    categories.BackgroundTransparency = 1
    categories.Size = UDim2.new(1, 0, 0.1, 0)
    categories.Position = UDim2.new(0, 0, 0.1, 0)
    categories.ScrollBarThickness = 5
    categories.AutomaticCanvasSize = Enum.AutomaticSize.X
    categories.CanvasSize = UDim2.new(0, 0, 0, 0)
    categories.Parent = mainFrame
    
    -- åŠŸèƒ½æŒ‰é’®å®¹å™¨
    local buttonsFrame = Instance.new("Frame")
    buttonsFrame.Name = "ButtonsFrame"
    buttonsFrame.BackgroundTransparency = 1
    buttonsFrame.Size = UDim2.new(1, 0, 0.7, 0)
    buttonsFrame.Position = UDim2.new(0, 0, 0.2, 0)
    buttonsFrame.Parent = mainFrame
    
    -- åˆ›å»ºåˆ†ç±»æŒ‰é’®
    local function CreateCategoryButton(name, positionX)
        local button = Instance.new("TextButton")
        button.Name = name .. "Category"
        button.Text = name
        button.TextColor3 = Color3.new(1, 1, 1)
        button.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
        button.Size = UDim2.new(0.3, 0, 1, 0)
        button.Position = UDim2.new(positionX, 0, 0, 0)
        button.Font = Enum.Font.SourceSansBold
        button.TextSize = 16
        button.Parent = categories
        return button
    end
    
    -- åˆ›å»ºåŠŸèƒ½æŒ‰é’®
    local function CreateFunctionButton(name, positionY, parent)
        local button = Instance.new("TextButton")
        button.Name = name .. "Button"
        button.Text = name
        button.TextColor3 = Color3.new(1, 1, 1)
        button.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
        button.Size = UDim2.new(0.9, 0, 0.15, 0)
        button.Position = UDim2.new(0.05, 0, positionY, 0)
        button.Font = Enum.Font.SourceSans
        button.TextSize = 16
        button.Parent = parent
        return button
    end
    
    -- åˆ›å»ºåˆ†ç±»
    local generalCategory = CreateCategoryButton("é€šç”¨", 0)
    local espCategory = CreateCategoryButton("ESP", 0.33)
    local feCategory = CreateCategoryButton("FE", 0.66)
    local devCategory = CreateCategoryButton("å¼€å‘äººå‘˜", 0.99)
    
    -- é€šç”¨åˆ†ç±»å†…å®¹
    local generalButtons = Instance.new("Frame")
    generalButtons.Name = "GeneralButtons"
    generalButtons.BackgroundTransparency = 1
    generalButtons.Size = UDim2.new(1, 0, 1, 0)
    generalButtons.Visible = true
    generalButtons.Parent = buttonsFrame
    
    local invincibleFlightButton = CreateFunctionButton("æ— æ•Œå°‘ä¾ é£è¡Œ", 0, generalButtons)
    local noclipButton = CreateFunctionButton("ç©¿å¢™", 0.2, generalButtons)
    local fastSpinButton = CreateFunctionButton("å¿«é€Ÿæ—‹è½¬ (é€Ÿåº¦50)", 0.4, generalButtons)
    local ultraSpinButton = CreateFunctionButton("æé€Ÿæ—‹è½¬ (é€Ÿåº¦100)", 0.6, generalButtons)
    local infiniteJumpButton = CreateFunctionButton("æ— é™è·³", 0.8, generalButtons)
    
    -- ESPåˆ†ç±»å†…å®¹
    local espButtons = Instance.new("Frame")
    espButtons.Name = "ESPButtons"
    espButtons.BackgroundTransparency = 1
    espButtons.Size = UDim2.new(1, 0, 1, 0)
    espButtons.Visible = false
    espButtons.Parent = buttonsFrame
    
    local drawPlayersButton = CreateFunctionButton("æ˜¾ç¤ºç»˜åˆ¶", 0, espButtons)
    local outlineButton = CreateFunctionButton("æ˜¾ç¤ºäººç‰©è½®å»“", 0.25, espButtons)
    local nameTagsButton = CreateFunctionButton("æ˜¾ç¤ºåå­—", 0.5, espButtons)
    
    -- FEåˆ†ç±»å†…å®¹
    local feButtons = Instance.new("Frame")
    feButtons.Name = "FEButtons"
    feButtons.BackgroundTransparency = 1
    feButtons.Size = UDim2.new(1, 0, 1, 0)
    feButtons.Visible = false
    feButtons.Parent = buttonsFrame
    
    -- å¼€å‘äººå‘˜åˆ†ç±»å†…å®¹
    local devButtons = Instance.new("Frame")
    devButtons.Name = "DevButtons"
    devButtons.BackgroundTransparency = 1
    devButtons.Size = UDim2.new(1, 0, 1, 0)
    devButtons.Visible = false
    devButtons.Parent = buttonsFrame
    
    local mainAuthor = Instance.new("TextLabel")
    mainAuthor.Name = "MainAuthor"
    mainAuthor.Text = "ä¸»ä½œè€…: å—çƒ›"
    mainAuthor.TextColor3 = Color3.new(1, 1, 1)
    mainAuthor.BackgroundTransparency = 1
    mainAuthor.Size = UDim2.new(1, 0, 0.2, 0)
    mainAuthor.Position = UDim2.new(0, 0, 0.2, 0)
    mainAuthor.Font = Enum.Font.SourceSansBold
    mainAuthor.TextSize = 18
    mainAuthor.Parent = devButtons
    
    local subAuthor = Instance.new("TextLabel")
    subAuthor.Name = "SubAuthor"
    subAuthor.Text = "å‰¯ä½œè€…: æ·±æƒ…æ¢¦è¯ä¸€"
    subAuthor.TextColor3 = Color3.new(1, 1, 1)
    subAuthor.BackgroundTransparency = 1
    subAuthor.Size = UDim2.new(1, 0, 0.2, 0)
    subAuthor.Position = UDim2.new(0, 0, 0.4, 0)
    subAuthor.Font = Enum.Font.SourceSansBold
    subAuthor.TextSize = 18
    subAuthor.Parent = devButtons
    
    -- åˆ†ç±»åˆ‡æ¢é€»è¾‘
    generalCategory.MouseButton1Click:Connect(function()
        generalButtons.Visible = true
        espButtons.Visible = false
        feButtons.Visible = false
        devButtons.Visible = false
    end)
    
    espCategory.MouseButton1Click:Connect(function()
        generalButtons.Visible = false
        espButtons.Visible = true
        feButtons.Visible = false
        devButtons.Visible = false
    end)
    
    feCategory.MouseButton1Click:Connect(function()
        generalButtons.Visible = false
        espButtons.Visible = false
        feButtons.Visible = true
        devButtons.Visible = false
    end)
    
    devCategory.MouseButton1Click:Connect(function()
        generalButtons.Visible = false
        espButtons.Visible = false
        feButtons.Visible = false
        devButtons.Visible = true
    end)
    
    -- ä½¿å¼¹çª—å¯æ‹–åŠ¨
    local dragging = false
    local dragStartPos = Vector2.new(0, 0)
    local frameStartPos = Vector2.new(0, 0)
    
    mainFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStartPos = Vector2.new(input.Position.X, input.Position.Y)
            frameStartPos = Vector2.new(mainFrame.Position.X.Offset, mainFrame.Position.Y.Offset)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = Vector2.new(input.Position.X, input.Position.Y) - dragStartPos
            mainFrame.Position = UDim2.new(0, frameStartPos.X + delta.X, 0, frameStartPos.Y + delta.Y)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    -- æŒ‰é’®åŠŸèƒ½
    -- æ— æ•Œå°‘ä¾ é£è¡Œ
    invincibleFlightButton.MouseButton1Click:Connect(function()
        loadstring(game:HttpGet("https://rawscripts.net/raw/Universal-Script-Invinicible-Flight-R15-45414"))()
        CreateNotification("æ— æ•Œå°‘ä¾ é£è¡Œå·²æ¿€æ´»")
    end)
    
    -- ç©¿å¢™
    local noclipActive = false
    noclipButton.MouseButton1Click:Connect(function()
        noclipActive = not noclipActive
        noclipButton.Text = noclipActive and "ç©¿å¢™ (å·²æ¿€æ´»)" or "ç©¿å¢™"
        
        if noclipActive then
            CreateNotification("ç©¿å¢™å·²æ¿€æ´»")
            
            local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
            local humanoid = character:WaitForChild("Humanoid")
            
            local noclipLoop
            noclipLoop = RunService.Stepped:Connect(function()
                if not noclipActive then
                    noclipLoop:Disconnect()
                    return
                end
                
                if character then
                    for _, part in pairs(character:GetDescendants()) do
                        if part:IsA("BasePart") then
                            part.CanCollide = false
                        end
                    end
                end
            end)
        else
            CreateNotification("ç©¿å¢™å·²å…³é—­")
        end
    end)
    
    -- å¿«é€Ÿæ—‹è½¬
    local fastSpinActive = false
    local fastSpinConnection
    fastSpinButton.MouseButton1Click:Connect(function()
        fastSpinActive = not fastSpinActive
        fastSpinButton.Text = fastSpinActive and "å¿«é€Ÿæ—‹è½¬ (å·²æ¿€æ´»)" or "å¿«é€Ÿæ—‹è½¬ (é€Ÿåº¦50)"
        
        if fastSpinActive then
            CreateNotification("å¿«é€Ÿæ—‹è½¬å·²æ¿€æ´»")
            
            local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
            local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
            
            fastSpinConnection = RunService.Heartbeat:Connect(function()
                if not fastSpinActive then
                    fastSpinConnection:Disconnect()
                    return
                end
                
                if humanoidRootPart then
                    humanoidRootPart.CFrame = humanoidRootPart.CFrame * CFrame.Angles(0, math.rad(50), 0)
                end
            end)
        else
            CreateNotification("å¿«é€Ÿæ—‹è½¬å·²å…³é—­")
        end
    end)
    
    -- æé€Ÿæ—‹è½¬
    local ultraSpinActive = false
    local ultraSpinConnection
    ultraSpinButton.MouseButton1Click:Connect(function()
        ultraSpinActive = not ultraSpinActive
        ultraSpinButton.Text = ultraSpinActive and "æé€Ÿæ—‹è½¬ (å·²æ¿€æ´»)" or "æé€Ÿæ—‹è½¬ (é€Ÿåº¦100)"
        
        if ultraSpinActive then
            CreateNotification("æé€Ÿæ—‹è½¬å·²æ¿€æ´»")
            
            local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
            local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
            
            ultraSpinConnection = RunService.Heartbeat:Connect(function()
                if not ultraSpinActive then
                    ultraSpinConnection:Disconnect()
                    return
                end
                
                if humanoidRootPart then
                    humanoidRootPart.CFrame = humanoidRootPart.CFrame * CFrame.Angles(0, math.rad(100), 0)
                end
            end)
        else
            CreateNotification("æé€Ÿæ—‹è½¬å·²å…³é—­")
        end
    end)
    
    -- æ— é™è·³
    local infiniteJumpActive = false
    local infiniteJumpConnection
    infiniteJumpButton.MouseButton1Click:Connect(function()
        infiniteJumpActive = not infiniteJumpActive
        infiniteJumpButton.Text = infiniteJumpActive and "æ— é™è·³ (å·²æ¿€æ´»)" or "æ— é™è·³"
        
        if infiniteJumpActive then
            CreateNotification("æ— é™è·³å·²æ¿€æ´»")
            
            local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
            local humanoid = character:WaitForChild("Humanoid")
            
            infiniteJumpConnection = UserInputService.JumpRequest:Connect(function()
                if infiniteJumpActive and humanoid then
                    humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                end
            end)
        else
            CreateNotification("æ— é™è·³å·²å…³é—­")
            if infiniteJumpConnection then
                infiniteJumpConnection:Disconnect()
            end
        end
    end)
    
    -- ESPåŠŸèƒ½
    local espObjects = {}
    
    -- æ˜¾ç¤ºç»˜åˆ¶
    local drawPlayersActive = false
    drawPlayersButton.MouseButton1Click:Connect(function()
        drawPlayersActive = not drawPlayersActive
        drawPlayersButton.Text = drawPlayersActive and "æ˜¾ç¤ºç»˜åˆ¶ (å·²æ¿€æ´»)" or "æ˜¾ç¤ºç»˜åˆ¶"
        
        if drawPlayersActive then
            CreateNotification("æ˜¾ç¤ºç»˜åˆ¶å·²æ¿€æ´»")
            
            local function createLine(player)
                if player == LocalPlayer then return end
                
                local line = Instance.new("LineHandleAdornment")
                line.Name = player.Name .. "Line"
                line.Adornee = workspace.Terrain
                line.Length = 100
                line.Thickness = 2
                line.Color3 = Color3.new(1, 1, 1)
                line.ZIndex = 1
                line.Parent = PlayerGui
                
                espObjects[player] = espObjects[player] or {}
                table.insert(espObjects[player], line)
                
                local character = player.Character
                if character then
                    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                    if humanoidRootPart then
                        line.CFrame = CFrame.new(humanoidRootPart.Position, LocalPlayer.Character.HumanoidRootPart.Position)
                        line.Length = (humanoidRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
                    end
                end
                
                local connection
                connection = RunService.Heartbeat:Connect(function()
                    if not drawPlayersActive then
                        connection:Disconnect()
                        return
                    end
                    
                    local character = player.Character
                    if character and LocalPlayer.Character then
                        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                        local localRootPart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                        
                        if humanoidRootPart and localRootPart then
                            line.CFrame = CFrame.new(humanoidRootPart.Position, localRootPart.Position)
                            line.Length = (humanoidRootPart.Position - localRootPart.Position).Magnitude
                        end
                    end
                end)
            end
            
            for _, player in pairs(Players:GetPlayers()) do
                createLine(player)
            end
            
            Players.PlayerAdded:Connect(createLine)
        else
            CreateNotification("æ˜¾ç¤ºç»˜åˆ¶å·²å…³é—­")
            for _, objects in pairs(espObjects) do
                for _, obj in ipairs(objects) do
                    if obj:IsA("LineHandleAdornment") then
                        obj:Destroy()
                    end
                end
            end
            espObjects = {}
        end
    end)
    
    -- æ˜¾ç¤ºäººç‰©è½®å»“
    local outlineActive = false
    outlineButton.MouseButton1Click:Connect(function()
        outlineActive = not outlineActive
        outlineButton.Text = outlineActive and "æ˜¾ç¤ºäººç‰©è½®å»“ (å·²æ¿€æ´»)" or "æ˜¾ç¤ºäººç‰©è½®å»“"
        
        if outlineActive then
            CreateNotification("æ˜¾ç¤ºäººç‰©è½®å»“å·²æ¿€æ´»")
            
            local function createOutline(player)
                if player == LocalPlayer then return end
                
                local character = player.Character
                if character then
                    for _, part in pairs(character:GetDescendants()) do
                        if part:IsA("BasePart") then
                            local highlight = Instance.new("Highlight")
                            highlight.Name = player.Name .. "Highlight"
                            highlight.FillTransparency = 1
                            highlight.OutlineColor = Color3.new(1, 1, 1)
                            highlight.OutlineTransparency = 0
                            highlight.Adornee = part
                            highlight.Parent = part
                            
                            espObjects[player] = espObjects[player] or {}
                            table.insert(espObjects[player], highlight)
                        end
                    end
                end
                
                player.CharacterAdded:Connect(function(newChar)
                    for _, part in pairs(newChar:GetDescendants()) do
                        if part:IsA("BasePart") then
                            local highlight = Instance.new("Highlight")
                            highlight.Name = player.Name .. "Highlight"
                            highlight.FillTransparency = 1
                            highlight.OutlineColor = Color3.new(1, 1, 1)
                            highlight.OutlineTransparency = 0
                            highlight.Adornee = part
                            highlight.Parent = part
                            
                            espObjects[player] = espObjects[player] or {}
                            table.insert(espObjects[player], highlight)
                        end
                    end
                end)
            end
            
            for _, player in pairs(Players:GetPlayers()) do
                createOutline(player)
            end
            
            Players.PlayerAdded:Connect(createOutline)
        else
            CreateNotification("æ˜¾ç¤ºäººç‰©è½®å»“å·²å…³é—­")
            for _, objects in pairs(espObjects) do
                for _, obj in ipairs(objects) do
                    if obj:IsA("Highlight") then
                        obj:Destroy()
                    end
                end
            end
            espObjects = {}
        end
    end)
    
    -- æ˜¾ç¤ºåå­—
    local nameTagsActive = false
    nameTagsButton.MouseButton1Click:Connect(function()
        nameTagsActive = not nameTagsActive
        nameTagsButton.Text = nameTagsActive and "æ˜¾ç¤ºåå­— (å·²æ¿€æ´»)" or "æ˜¾ç¤ºåå­—"
        
        if nameTagsActive then
            CreateNotification("æ˜¾ç¤ºåå­—å·²æ¿€æ´»")
            
            local function createNameTag(player)
                if player == LocalPlayer then return end
                
                local character = player.Character
                if character then
                    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                    if humanoidRootPart then
                        local billboard = Instance.new("BillboardGui")
                        billboard.Name = player.Name .. "NameTag"
                        billboard.Adornee = humanoidRootPart
                        billboard.Size = UDim2.new(0, 200, 0, 50)
                        billboard.StudsOffset = Vector3.new(0, 3, 0)
                        billboard.AlwaysOnTop = true
                        billboard.Parent = humanoidRootPart
                        
                        local textLabel = Instance.new("TextLabel")
                        textLabel.Name = "NameLabel"
                        textLabel.Text = player.Name
                        textLabel.TextColor3 = Color3.new(1, 1, 1)
                        textLabel.BackgroundTransparency = 1
                        textLabel.Size = UDim2.new(1, 0, 1, 0)
                        textLabel.Font = Enum.Font.SourceSansBold
                        textLabel.TextSize = 18
                        textLabel.Parent = billboard
                        
                        espObjects[player] = espObjects[player] or {}
                        table.insert(espObjects[player], billboard)
                    end
                end
                
                player.CharacterAdded:Connect(function(newChar)
                    local humanoidRootPart = newChar:WaitForChild("HumanoidRootPart")
                    local billboard = Instance.new("BillboardGui")
                    billboard.Name = player.Name .. "NameTag"
                    billboard.Adornee = humanoidRootPart
                    billboard.Size = UDim2.new(0, 200, 0, 50)
                    billboard.StudsOffset = Vector3.new(0, 3, 0)
                    billboard.AlwaysOnTop = true
                    billboard.Parent = humanoidRootPart
                    
                    local textLabel = Instance.new("TextLabel")
                    textLabel.Name = "NameLabel"
                    textLabel.Text = player.Name
                    textLabel.TextColor3 = Color3.new(1, 1, 1)
                    textLabel.BackgroundTransparency = 1
                    textLabel.Size = UDim2.new(1, 0, 1, 0)
                    textLabel.Font = Enum.Font.SourceSansBold
                    textLabel.TextSize = 18
                    textLabel.Parent = billboard
                    
                    espObjects[player] = espObjects[player] or {}
                    table.insert(espObjects[player], billboard)
                end)
            end
            
            for _, player in pairs(Players:GetPlayers()) do
                createNameTag(player)
            end
            
            Players.PlayerAdded:Connect(createNameTag)
        else
            CreateNotification("æ˜¾ç¤ºåå­—å·²å…³é—­")
            for _, objects in pairs(espObjects) do
                for _, obj in ipairs(objects) do
                    if obj:IsA("BillboardGui") then
                        obj:Destroy()
                    end
                end
            end
            espObjects = {}
        end
    end)
    
    -- å¼€å…³å¼¹çª—
    local popupVisible = true
    local toggleButton = Instance.new("TextButton")
    toggleButton.Name = "ToggleButton"
    toggleButton.Text = "éšè—åŠ©æ‰‹"
    toggleButton.TextColor3 = Color3.new(1, 1, 1)
    toggleButton.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    toggleButton.Size = UDim2.new(0.2, 0, 0.05, 0)
    toggleButton.Position = UDim2.new(0, 0, 0.95, 0)
    toggleButton.Font = Enum.Font.SourceSans
    toggleButton.TextSize = 14
    toggleButton.Parent = screenGui
    
    toggleButton.MouseButton1Click:Connect(function()
        popupVisible = not popupVisible
        toggleButton.Text = popupVisible and "éšè—åŠ©æ‰‹" or "æ˜¾ç¤ºåŠ©æ‰‹"
        mainFrame.Visible = popupVisible
        background.Visible = popupVisible
    end)
    
    -- å…³é—­è„šæœ¬
    closeButton.MouseButton1Click:Connect(function()
        CreateNotification("è„šæœ¬å·²å…³é—­", 2)
        wait(2)
        
        -- æ¸…ç†æ‰€æœ‰åŠŸèƒ½
        if noclipActive then
            noclipActive = false
            noclipButton.Text = "ç©¿å¢™"
        end
        
        if fastSpinActive then
            fastSpinActive = false
            fastSpinButton.Text = "å¿«é€Ÿæ—‹è½¬ (é€Ÿåº¦50)"
        end
        
        if ultraSpinActive then
            ultraSpinActive = false
            ultraSpinButton.Text = "æé€Ÿæ—‹è½¬ (é€Ÿåº¦100)"
        end
        
        if infiniteJumpActive then
            infiniteJumpActive = false
            infiniteJumpButton.Text = "æ— é™è·³"
        end
        
        if drawPlayersActive then
            drawPlayersActive = false
            drawPlayersButton.Text = "æ˜¾ç¤ºç»˜åˆ¶"
        end
        
        if outlineActive then
            outlineActive = false
            outlineButton.Text = "æ˜¾ç¤ºäººç‰©è½®å»“"
        end
        
        if nameTagsActive then
            nameTagsActive = false
            nameTagsButton.Text = "æ˜¾ç¤ºåå­—"
        end
        
        -- æ¸…ç†ESPå¯¹è±¡
        for _, objects in pairs(espObjects) do
            for _, obj in ipairs(objects) do
                if obj then
                    obj:Destroy()
                end
            end
        end
        
        -- å…³é—­æ‰€æœ‰è¿æ¥
        for _, connection in pairs(getconnections(UserInputService.JumpRequest)) do
            connection:Disconnect()
        end
        
        screenGui:Destroy()
    end)
    
    screenGui.Parent = PlayerGui
    return screenGui
end

-- åˆå§‹åŒ–
SendChatMessage("æ¬¢è¿ä½¿ç”¨å—çƒ›æ¸¸æˆåŠ©æ‰‹", false)
SendChatMessage("è¿™æ¡æ¶ˆæ¯åªæœ‰æ‚¨è‡ªå·±èƒ½çœ‹åˆ°", true)

-- å³ä¸‹è§’æç¤º
CreateNotification("è„šæœ¬æ‰§è¡ŒæˆåŠŸ", 5)

-- åˆ›å»ºå¡å¯†ç³»ç»Ÿ
CreateKeySystem()
