-- 南烛游戏助手主脚本
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- 发送聊天消息
local function SendChatMessage(message, teamOnly)
    local ChatService = game:GetService("Chat")
    ChatService.ChatLocal(message, "System", LocalPlayer)
    if teamOnly then
        ChatService.ChatPrivate(message, "System", LocalPlayer, LocalPlayer)
    end
end

-- 创建提示框
local function CreateNotification(text)
    local notification = Instance.new("TextLabel")
    notification.Name = "GameHelperNotification"
    notification.Text = text
    notification.TextColor3 = Color3.new(1, 1, 1)
    notification.BackgroundColor3 = Color3.new(0, 0, 0)
    notification.BackgroundTransparency = 0.5
    notification.Size = UDim2.new(0.2, 0, 0.05, 0)
    notification.Position = UDim2.new(0.8, 0, 0.9, 0)
    notification.Font = Enum.Font.SourceSansBold
    notification.TextSize = 14
    notification.Parent = PlayerGui
    
    -- 淡出效果
    game:GetService("TweenService"):Create(
        notification,
        TweenInfo.new(1, Enum.EasingStyle.Linear),
        {TextTransparency = 1, BackgroundTransparency = 1}
    ):Play()
    
    game.Debris:AddItem(notification, 3)
end

-- 创建主弹窗
local function CreateMainPopup()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "NanzhuGameHelper"
    screenGui.ResetOnSpawn = false
    
    -- 背景遮罩
    local background = Instance.new("Frame")
    background.Name = "Background"
    background.Size = UDim2.new(1, 0, 1, 0)
    background.BackgroundColor3 = Color3.new(0, 0, 0)
    background.BackgroundTransparency = 0.5
    background.BorderSizePixel = 0
    background.Parent = screenGui
    
    -- 主弹窗
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0.4, 0, 0.6, 0)
    mainFrame.Position = UDim2.new(0.3, 0, 0.2, 0)
    mainFrame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = screenGui
    
    -- 标题
    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Text = "南烛游戏助手"
    title.TextColor3 = Color3.new(1, 1, 1)
    title.BackgroundTransparency = 1
    title.Size = UDim2.new(1, 0, 0.1, 0)
    title.Font = Enum.Font.SourceSansBold
    title.TextSize = 20
    title.Parent = mainFrame
    
    -- 关闭按钮
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.Text = "X"
    closeButton.TextColor3 = Color3.new(1, 1, 1)
    closeButton.BackgroundTransparency = 1
    closeButton.Size = UDim2.new(0.1, 0, 0.1, 0)
    closeButton.Position = UDim2.new(0.9, 0, 0, 0)
    closeButton.Font = Enum.Font.SourceSansBold
    closeButton.TextSize = 20
    closeButton.Parent = mainFrame
    
    -- 分类标题
    local categoryTitle = Instance.new("TextLabel")
    categoryTitle.Name = "CategoryTitle"
    categoryTitle.Text = "通用分类"
    categoryTitle.TextColor3 = Color3.new(0, 1, 1)
    categoryTitle.BackgroundTransparency = 1
    categoryTitle.Size = UDim2.new(1, 0, 0.1, 0)
    categoryTitle.Position = UDim2.new(0, 0, 0.1, 0)
    categoryTitle.Font = Enum.Font.SourceSansBold
    categoryTitle.TextSize = 18
    categoryTitle.Parent = mainFrame
    
    -- 功能按钮容器
    local buttonsFrame = Instance.new("Frame")
    buttonsFrame.Name = "ButtonsFrame"
    buttonsFrame.BackgroundTransparency = 1
    buttonsFrame.Size = UDim2.new(1, 0, 0.7, 0)
    buttonsFrame.Position = UDim2.new(0, 0, 0.2, 0)
    buttonsFrame.Parent = mainFrame
    
    -- 无敌少侠飞行按钮
    local invincibleFlightButton = Instance.new("TextButton")
    invincibleFlightButton.Name = "InvincibleFlightButton"
    invincibleFlightButton.Text = "无敌少侠飞行"
    invincibleFlightButton.TextColor3 = Color3.new(1, 1, 1)
    invincibleFlightButton.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    invincibleFlightButton.Size = UDim2.new(0.9, 0, 0.15, 0)
    invincibleFlightButton.Position = UDim2.new(0.05, 0, 0, 0)
    invincibleFlightButton.Font = Enum.Font.SourceSans
    invincibleFlightButton.TextSize = 16
    invincibleFlightButton.Parent = buttonsFrame
    
    -- 穿墙按钮
    local noclipButton = Instance.new("TextButton")
    noclipButton.Name = "NoclipButton"
    noclipButton.Text = "穿墙"
    noclipButton.TextColor3 = Color3.new(1, 1, 1)
    noclipButton.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    noclipButton.Size = UDim2.new(0.9, 0, 0.15, 0)
    noclipButton.Position = UDim2.new(0.05, 0, 0.2, 0)
    noclipButton.Font = Enum.Font.SourceSans
    noclipButton.TextSize = 16
    noclipButton.Parent = buttonsFrame
    
    -- 快速旋转按钮
    local fastSpinButton = Instance.new("TextButton")
    fastSpinButton.Name = "FastSpinButton"
    fastSpinButton.Text = "快速旋转 (速度50)"
    fastSpinButton.TextColor3 = Color3.new(1, 1, 1)
    fastSpinButton.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    fastSpinButton.Size = UDim2.new(0.9, 0, 0.15, 0)
    fastSpinButton.Position = UDim2.new(0.05, 0, 0.4, 0)
    fastSpinButton.Font = Enum.Font.SourceSans
    fastSpinButton.TextSize = 16
    fastSpinButton.Parent = buttonsFrame
    
    -- 极速旋转按钮
    local ultraSpinButton = Instance.new("TextButton")
    ultraSpinButton.Name = "UltraSpinButton"
    ultraSpinButton.Text = "极速旋转 (速度100)"
    ultraSpinButton.TextColor3 = Color3.new(1, 1, 1)
    ultraSpinButton.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    ultraSpinButton.Size = UDim2.new(0.9, 0, 0.15, 0)
    ultraSpinButton.Position = UDim2.new(0.05, 0, 0.6, 0)
    ultraSpinButton.Font = Enum.Font.SourceSans
    ultraSpinButton.TextSize = 16
    ultraSpinButton.Parent = buttonsFrame
    
    -- 开关按钮
    local toggleButton = Instance.new("TextButton")
    toggleButton.Name = "ToggleButton"
    toggleButton.Text = "隐藏助手"
    toggleButton.TextColor3 = Color3.new(1, 1, 1)
    toggleButton.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    toggleButton.Size = UDim2.new(0.2, 0, 0.05, 0)
    toggleButton.Position = UDim2.new(0, 0, 0.95, 0)
    toggleButton.Font = Enum.Font.SourceSans
    toggleButton.TextSize = 14
    toggleButton.Parent = screenGui
    
    -- 使弹窗可拖动
    local dragging = false
    local dragStartPos = Vector2.new(0, 0)
    local frameStartPos = Vector2.new(0, 0)
    
    mainFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStartPos = Vector2.new(input.Position.X, input.Position.Y)
            frameStartPos = Vector2.new(mainFrame.Position.X.Offset, mainFrame.Position.Y.Offset)
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = Vector2.new(input.Position.X, input.Position.Y) - dragStartPos
            mainFrame.Position = UDim2.new(0, frameStartPos.X + delta.X, 0, frameStartPos.Y + delta.Y)
        end
    end)
    
    game:GetService("UserInputService").InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    -- 按钮功能
    invincibleFlightButton.MouseButton1Click:Connect(function()
        loadstring(game:HttpGet("https://rawscripts.net/raw/Universal-Script-Invinicible-Flight-R15-45414"))()
        CreateNotification("无敌少侠飞行已激活")
    end)
    
    local noclipActive = false
    noclipButton.MouseButton1Click:Connect(function()
        noclipActive = not noclipActive
        noclipButton.Text = noclipActive and "穿墙 (已激活)" or "穿墙"
        
        if noclipActive then
            CreateNotification("穿墙已激活")
            
            local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
            local humanoid = character:WaitForChild("Humanoid")
            
            local noclipLoop
            noclipLoop = game:GetService("RunService").Stepped:Connect(function()
                if not noclipActive then
                    noclipLoop:Disconnect()
                    return
                end
                
                if character then
                    for _, part in pairs(character:GetDescendants()) do
                        if part:IsA("BasePart") then
                            part.CanCollide = false
                        end
                    end
                end
            end)
        else
            CreateNotification("穿墙已关闭")
        end
    end)
    
    local fastSpinActive = false
    local fastSpinConnection
    fastSpinButton.MouseButton1Click:Connect(function()
        fastSpinActive = not fastSpinActive
        fastSpinButton.Text = fastSpinActive and "快速旋转 (已激活)" or "快速旋转 (速度50)"
        
        if fastSpinActive then
            CreateNotification("快速旋转已激活")
            
            local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
            local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
            
            fastSpinConnection = game:GetService("RunService").Heartbeat:Connect(function()
                if not fastSpinActive then
                    fastSpinConnection:Disconnect()
                    return
                end
                
                if humanoidRootPart then
                    humanoidRootPart.CFrame = humanoidRootPart.CFrame * CFrame.Angles(0, math.rad(50), 0)
                end
            end)
        else
            CreateNotification("快速旋转已关闭")
        end
    end)
    
    local ultraSpinActive = false
    local ultraSpinConnection
    ultraSpinButton.MouseButton1Click:Connect(function()
        ultraSpinActive = not ultraSpinActive
        ultraSpinButton.Text = ultraSpinActive and "极速旋转 (已激活)" or "极速旋转 (速度100)"
        
        if ultraSpinActive then
            CreateNotification("极速旋转已激活")
            
            local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
            local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
            
            ultraSpinConnection = game:GetService("RunService").Heartbeat:Connect(function()
                if not ultraSpinActive then
                    ultraSpinConnection:Disconnect()
                    return
                end
                
                if humanoidRootPart then
                    humanoidRootPart.CFrame = humanoidRootPart.CFrame * CFrame.Angles(0, math.rad(100), 0)
                end
            end)
        else
            CreateNotification("极速旋转已关闭")
        end
    end)
    
    -- 开关弹窗
    local popupVisible = true
    toggleButton.MouseButton1Click:Connect(function()
        popupVisible = not popupVisible
        toggleButton.Text = popupVisible and "隐藏助手" or "显示助手"
        mainFrame.Visible = popupVisible
        background.Visible = popupVisible
    end)
    
    screenGui.Parent = PlayerGui
    
    return screenGui
end

-- 初始化
SendChatMessage("欢迎使用男主游戏助手", false)
SendChatMessage("这条消息只有您自己能看到", true)
CreateNotification("执行成功")

-- 创建主弹窗
CreateMainPopup()
